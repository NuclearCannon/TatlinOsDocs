# 小幅改进

- 将tid分配器的分配逻辑独立出去，使其成为可复用的分配器。

- 修复了TrustOS中chdir不能正确运行的bug

- 为了应付`which ls`，在`fs::init()`的`create_init_files`时，会创建`/bin/ls`（其实是指向`/musl/busybox`的符号链接）

- 为了应付临时文件这一功能，TatlinOS会真的在`/tmp`文件夹中创建一个新文件，并且永远不会主动删除它（这是不是值得改进？）

- 维护了一个动态链接库名→动态链接库路径的映射，当用户程序试图打开或者链接这些文件时，内核会重定向到真正的位置上

  - 代码如下

  - ```rust
    pub fn map_library_path(requested_path: &str) -> Option<&str> {
        match requested_path {
            "/lib/dlopen_dso.so" => Some("/glibc/lib/dlopen_dso.so"),
            "/lib/ld-linux-riscv64-lp64d.so.1" => Some("/glibc/lib/ld-linux-riscv64-lp64d.so.1"),
            "/lib/ld-linux-riscv64-lp64.so.1" => Some("/glibc/lib/ld-linux-riscv64-lp64d.so.1"), // 你也给我用带d的版本
            "/lib/libc.so" => Some("/glibc/lib/libc.so"),
            "/lib/libm.so" => Some("/glibc/lib/libm.so"),
            "/lib/tls_align_dso.so" => Some("/glibc/lib/tls_align_dso.so"),
            "/lib/tls_get_new-dtv_dso.so" => Some("/glibc/lib/tls_get_new-dtv_dso.so"),
            "/lib/tls_init_dso.so" => Some("/glibc/lib/tls_init_dso.so"),
            "/lib/ld-musl-riscv64.so.1" => Some("/musl/lib/libc.so"), // ltp
            "/lib/ld-musl-riscv64-sf.so.1" => Some("/musl/lib/libc.so"), // libctest
            "/usr/lib/libm.so.6" => Some("/glibc/lib/libm.so"),       // libctest
            "/usr/lib/libc.so.6" => Some("/glibc/lib/libc.so"),       // libctest
            _ => None,
        }
    }
    ```

    

- TrustOS中，`virtio-drivers`库用的是0.1.0且是定制版，不能被vendor管理。TatlinOS中把它更新到了0.2.0，且不是定制版，可以被vendor管理

  - 然而，tatlinOS引入了另一个定制库（cty）……



