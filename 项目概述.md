# 项目概述

本项目基于使用GPL开源协议的TrustOs，在其基础上进行改进。

TrustOs参考链接为：[educg-net-26010-2376550 / OSKernel2024-TrustOS-1800 · GitLab](https://gitlab.eduxiji.net/educg-group-26010-2376550/T202410487992457-1800)。

## 项目结构

项目结构如下所示：

```
tatlin-os/
├── os/                              # 内核主目录
│   ├── src/                         # 内核源代码
│   │   ├── arch/                    # 架构相关代码
│   │   │   ├── loongarch64/         # 龙芯64位架构实现
│   │   │   │   └── qemu/            # QEMU平台特定代码
│   │   │   └── riscv64/             # RISC-V 64位架构实现
│   │   │       └── qemu/            # QEMU平台特定代码
│   │   ├── drivers/                 # 设备驱动程序
│   │   │   └── virtio/              # VirtIO设备驱动
│   │   ├── fs/                      # 文件系统实现
│   │   │   ├── ext4_lw/             # 轻量级Ext4文件系统
│   │   │   ├── files/               # 文件操作
│   │   │   └── kernel_fs_ops/       # 内核文件系统操作
│   │   ├── mm/                      # 内存管理
│   │   ├── signal/                  # 信号处理
│   │   ├── syscall/                 # 系统调用
│   │   ├── task/                    # 任务管理
│   │   ├── trap/                    # 异常和中断处理
│   │   └── utils/                   # 工具函数
│   ├── target/                      # 编译输出目录
│   └── vendor/                      # 第三方依赖
├── user/                            # 用户程序
│   ├── src/                         # 用户程序源代码
│   │   ├── arch/                    # 架构相关用户代码
│   │   ├── bin/                     # 用户程序二进制
│   │   │   └── libctest/            # libc测试程序
│   │   └── example/                 # 示例程序
│   ├── target/                      # 用户程序编译输出
│   └── vendor/                      # 用户程序依赖
├── lwext4_rust/                     # Rust版本的lwext4文件系统
│   ├── src/                         # lwext4源代码
│   ├── c/                           # C语言绑定
│   └── examples/                    # 示例代码
├── make_scripts/                    # 构建脚本
│   ├── loongarch64.mk               # 龙芯架构构建配置
│   ├── riscv64.mk                   # RISC-V架构构建配置
│   └── user.mk                      # 用户程序构建配置
├── 2025_testsuits_img/              # 测试套件镜像
│   ├── pre-2025/                    # 2025年前的测试镜像
│   │   ├── sdcard-la.img            # 龙芯测试镜像
│   │   └── sdcard-rv.img            # RISC-V测试镜像
│   ├── source_code/                 # 测试套件源码
│   └── mnt/                         # 挂载点目录
│       ├── glibc/                   # glibc测试环境
│       └── musl/                    # musl测试环境
├── 2025-tmp-docs/                   # 项目文档
│   └── TatlinOsDocs/                # TatlinOS文档
│       ├── 项目概述.md              # 项目概述文档
│       └── loongarch64迁移过程.md   # 龙芯迁移文档
├── doc/                             # 技术文档
│   ├── cyclictest.md                # 实时性测试文档
│   ├── iozone.md                    # I/O性能测试文档
│   ├── libc_test.md                 # libc测试文档
│   ├── lmbench.md                   # 系统性能基准测试文档
│   ├── ltp.md                       # Linux测试项目文档
│   └── unixbench.md                 # Unix基准测试文档
├── cty/                             # 串口终端库
└── kernel-la/kernel-rv              # 编译后的内核文件
```

### 重要目录说明

- **os/src/arch/**: 包含不同架构的实现，支持RISC-V 64位和龙芯64位架构
- **os/src/drivers/**: 设备驱动，主要包含VirtIO设备驱动，支持MMIO和PCI两种传输方式
- **os/src/fs/**: 文件系统实现，包含轻量级Ext4文件系统支持
- **lwext4_rust/**: 独立的Rust版本lwext4文件系统实现
- **make_scripts/**: 构建配置脚本，分别支持不同架构的编译
- **2025_testsuits_img/**: 包含测试套件和不同C库环境的测试镜像

## 开发进度

目前我们还未完全实现向龙芯架构的迁移，虽然大部分与架构相关的功能（如文件系统，trap等）都已经实现，可以运行简单的应用程序，但是在涉及信号相关的程序时，会出现未解决的bug

### 开发分支

龙芯架构的开发分支为`feature/hal`（不是`feature/loongarch64`！）

主分支是 `2025-tatlin`（不是`main`！）

### 对各个测试集的通过情况

我们可以通过的测试集包括：

- busybox（满分）
- basic（满分）
- iozone(仅musl)
- libctest(仅musl，glibc的libctest已不再计分)
- lua（满分）

| 测试点     | glibc-la | glibc-rv | musl-la | musl-rv            | 总分              |
| ---------- | -------- | -------- | ------- | ------------------ | ----------------- |
| basic      | 0        | 102      | 0       | 102                | 204               |
| busybox    | 0        | 54       | 0       | 54                 | 108               |
| cyclictest | 0.0      | 0.0      | 0.0     | 0.0                | 0.0               |
| iozone     | 0.0      | 0.0      | 0.0     | 29.5091749504625   | 29.5091749504625  |
| iperf      | 0.0      | 0.0      | 0.0     | 0.0                | 0.0               |
| libcbench  | 0.0      | 0.0      | 0.0     | 0.0                | 0.0               |
| libctest   | -        | -        | 0       | 210                | 210               |
| lmbench    | 0.0      | 0.0      | 0.0     | 0.0                | 0.0               |
| ltp        | 0        | 0        | 0       | 0                  | 0                 |
| lua        | 0        | 9        | 0       | 9                  | 18                |
| netperf    | 0.0      | 0.0      | 0.0     | 0.0                | 0.0               |
| 总分       | 0.0      | 165.0    | 0.0     | 404.50917495046247 | 569.5091749504625 |
